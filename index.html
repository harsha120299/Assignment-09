<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assignment 09</title>
    <style>
      body {
        margin: 0;
        background: url(assest/image/aerial-view-garden-background_1308-27471.avif)
          no-repeat center;
        background-size: cover;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }
      #road {
        background: url(assest/image/istockphoto-1425173064-612x612.jpg)
          repeat-y;
        height: 100vh;
        width: 40vw;
        position: relative;
        overflow: hidden;
      }
      #start {
        position: absolute;
        top: 77vh;
        left: 50%;
        transform: translateX(-50%);
        font-size: 2rem;
        background-color: rgb(245, 99, 99);
        color: white;
        padding: 10px 20px;
        border-radius: 10px;
        cursor: pointer;
      }
      #score {
        position: absolute;
        top: 20px;
        left: 20px;
        font-size: 2rem;
        color: white;
      }
      .enemycar {
        position: absolute;
        scale: 0.2;
        visibility: hidden;
      }
      #enemycar1 {
        top: -100px;
        left: -80px;
      }
      #enemycar2 {
        top: -300px;
        left: 195px;
      }
      #enemycar3 {
        top: 155px;
        left: 190px;
      }
      #myCar {
        position: absolute;
        bottom: -288px;
        left: -7%;
        transform: translateX(-50%);
        scale: 0.25;
      }
      @keyframes ecar1 {
        0% {
          top: -150px;
        }
        100% {
          top: 100vh;
        }
      }
      @keyframes ecar2 {
        0% {
          top: -300px;
        }
        100% {
          top: 100vh;
        }
      }
      @keyframes ecar3 {
        0% {
          top: -500px;
        }
        100% {
          top: 100vh;
        }
      }
    </style>
  </head>
  <body>
    <div id="road">
      <div id="score">Score : 0</div>
      <button id="start">Start</button>

      <img
        id="enemycar1"
        class="enemycar"
        src="assest/image/whiteCar.png"
        alt="Enemy Car 1"
      />
      <img
        id="enemycar2"
        class="enemycar"
        src="assest/image/whiteCar.png"
        alt="Enemy Car 2"
      />
      <img
        id="enemycar3"
        class="enemycar"
        src="assest/image/whiteCar.png"
        alt="Enemy Car 3"
      />
      <img id="myCar" src="assest/image/defnder.png" alt="My Car" />
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        let score = 0;
        let gameStarted = false;
        let carPositionX = -7;
        let carPositionY = 39;

        const enemyCar1 = $("#enemycar1");
        const enemyCar2 = $("#enemycar2");
        const enemyCar3 = $("#enemycar3");
        const myCar = $("#myCar");

        let gameInterval;

        $(document).keydown(function (e) {
          if (gameStarted) {
            if (e.key === "ArrowLeft" && carPositionX > 0) {
              carPositionX -= 5;
            }
            if (e.key === "ArrowRight" && carPositionX < 80) {
              carPositionX += 5;
            }
            if (e.key === "ArrowUp" && carPositionY > 0) {
              carPositionY -= 5;
            }
            if (e.key === "ArrowDown" && carPositionY < 80) {
              carPositionY += 5;
            }
            myCar.css({
              left: carPositionX + "%",
              top: carPositionY + "%",
            });
          }
        });

        $("#start").click(function () {
          if (!gameStarted) {
            gameStarted = true;
            $("#start").hide();

            enemyCar1.css({
              visibility: "visible",
              animation: "ecar1 infinite linear 8s",
            });
            enemyCar2.css({
              visibility: "visible",
              animation: "ecar2 infinite linear 10s",
            });
            enemyCar3.css({
              visibility: "visible",
              animation: "ecar3 infinite linear 15s",
            });

            score = 0;
            $("#score").text("Score : " + score);

            gameInterval = setInterval(moveEnemyCars, 50);
          }
        });

        function moveEnemyCars() {
          $(".enemycar").each(function () {
            let car = $(this);
            let currentTop = parseInt(car.css("top"));
            let newTop = currentTop + 5;

            if (newTop > 100) {
              newTop = -100;
              score++;
              $("#score").text("Score : " + score);

              if (score > 50) {
                newTop += 2;
              }
              if (score > 100) {
                newTop += 2;
              }
            }

            car.css("top", newTop + "px");

            if (checkCollision(myCar, car)) {
              gameOver();
            }
          });
        }

        function checkCollision(car1, car2) {
          let car1Pos = car1[0].getBoundingClientRect();
          let car2Pos = car2[0].getBoundingClientRect();

          return !(
            car1Pos.right < car2Pos.left ||
            car1Pos.left > car2Pos.right ||
            car1Pos.bottom < car2Pos.top ||
            car1Pos.top > car2Pos.bottom
          );
        }

        function gameOver() {
          clearInterval(gameInterval);
          alert("Game Over! Your score is: " + score);
          resetGame();
        }

        function resetGame() {
          myCar.css({ left: "-7%", top: "39%" });
          enemyCar1.css("top", "-100px");
          enemyCar2.css("top", "-300px");
          enemyCar3.css("top", "155px");
          gameStarted = false;
          $("#start").show();
        }
      });
    </script>
  </body>
</html>
